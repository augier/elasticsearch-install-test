box: wercker/php
build:
  steps:

    # - augier/elasticsearch-install:
    #     version: 1.3.1

    - script:
        name: Test
        code: |
            sudo wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -
            sudo debconf shared/accepted-oracle-license-v1-1 select true | debconf-set-selections
            sudo debconf shared/accepted-oracle-license-v1-1 seen true | debconf-set-selections
            sudo add-apt-repository ppa:webupd8team/java -y

    - install-packages:
        packages:
            oracle-java7-installer

    - script:
        name: finalise
        code: |
            sudo wget -O /tmp/elasticsearch-$WERCKER_ELASTICSEARCH_INSTALL_VERSION.deb https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-$WERCKER_ELASTICSEARCH_INSTALL_VERSION.deb
            sudo dpkg -i /tmp/elasticsearch-$WERCKER_ELASTICSEARCH_INSTALL_VERSION.deb
            sudo echo "network.bind_host: 127.0.0.1" >>  /etc/elasticsearch/elasticsearch.yml
            sudo echo "script.disable_dynamic: true" >>  /etc/elasticsearch/elasticsearch.yml
            sudo service elasticsearch restart

    - script:
        name: Test elasticsearch
        code: curl -I 'http://127.0.0.1:9200/'
