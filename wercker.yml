box: wercker/php
build:
  steps:

    # - augier/elasticsearch-install:
    #     version: 1.3.1

    # - script:
    #     name: Test
    #     code: |
    #         sudo wget -O - http://packages.elasticsearch.org/GPG-KEY-elasticsearch | sudo apt-key add -
    #         sudo debconf shared/accepted-oracle-license-v1-1 select true | debconf-set-selections
    #         sudo debconf shared/accepted-oracle-license-v1-1 seen true | debconf-set-selections
    #         sudo add-apt-repository ppa:webupd8team/java -y

    - install-packages:
        packages:
            openjdk-7-jre-headless

    - script:
        name: finalise
        code: |
            wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.3.1.deb
            sudo dpkg -i elasticsearch-1.3.1.deb
            sudo sed -i 's/# http.enabled: false/http.enabled: true/g' /etc/elasticsearch/elasticsearch.yml
            sudo sed -i 's/# network.host: 192.168.0.1/network.host: 127.0.0.1/g' /etc/elasticsearch/elasticsearch.yml
            sudo sed -i 's/#http.port: 9200/http.port: 9200/g' /etc/elasticsearch/elasticsearch.yml
            sudo service elasticsearch restart
            sudo netstat -tulpn
            sudo ifconfig

# sudo sed -i 's/# http.enabled: false/http.enabled: true/g' /etc/elasticsearch/elasticsearch.yml
# sudo sed -i 's/# network.host: 192.168.0.1/network.host: $$HOST$$/g' /etc/elasticsearch/elasticsearch.yml